<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatGPT Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/brython@3.11/brython.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/brython@3.11/brython_stdlib.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body onload="brython()" class="bg-gray-100 h-screen">
    <div class="container mx-auto max-w-3xl h-screen flex flex-col">
        <div class="bg-white shadow-md rounded-t-lg flex-1 flex flex-col">
            <div class="p-4 border-b border-gray-200">
                <h1 class="text-xl font-semibold">ChatGPT Simulator (Gemini)</h1>
            </div>

            <div id="chat-container" class="flex-1 overflow-y-auto p-4 space-y-4">
                <div class="flex items-start gap-2">
                    <div class="w-8 h-8 rounded-full bg-green-500 flex items-center justify-center text-white">AI</div>
                    <div class="max-w-[80%] bg-gray-100 p-3 rounded-lg">
                        Hello! I'm your Gemini-powered assistant. How can I help you today?
                    </div>
                </div>
            </div>

            <div class="p-4 border-t border-gray-200">
                <div class="flex gap-2">
                    <input type="text" id="user-input"
                        class="flex-1 p-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500"
                        placeholder="Type your message here...">
                    <button id="send-btn" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                        Send
                    </button>
                </div>
                <p class="text-sm text-gray-500 mt-2">Powered by Gemini API - responses are generated in real-time</p>
            </div>
        </div>
    </div>

    <script type="text/python">
from browser import document, timer, ajax, prompt
import json

# Get API key from user
API_KEY = prompt("Please enter your Gemini API key:")
BASE_URL = f"https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key={API_KEY}"

def add_message(message, is_user=False):
    chat_container = document["chat-container"]

    message_div = document.createElement("div")
    message_div.className = "flex items-start gap-2 " + ("justify-end" if is_user else "")

    if is_user:
        message_div.innerHTML = f'''
            <div class="max-w-[80%] bg-blue-500 text-white p-3 rounded-lg">
                {message}
            </div>
            <div class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white">You</div>
        '''
    else:
        message_div.innerHTML = f'''
            <div class="w-8 h-8 rounded-full bg-green-500 flex items-center justify-center text-white">AI</div>
            <div class="max-w-[80%] bg-gray-100 p-3 rounded-lg">
                {message}
            </div>
        '''

    chat_container.appendChild(message_div)
    chat_container.scrollTop = chat_container.scrollHeight

def show_thinking():
    chat_container = document["chat-container"]

    thinking_div = document.createElement("div")
    thinking_div.className = "flex items-start gap-2"
    thinking_div.id = "thinking-indicator"

    thinking_div.innerHTML = f'''
        <div class="w-8 h-8 rounded-full bg-green-500 flex items-center justify-center text-white">AI</div>
        <div class="max-w-[80%] bg-gray-100 p-3 rounded-lg animate-pulse">
            Processing your request...
        </div>
    '''

    chat_container.appendChild(thinking_div)
    chat_container.scrollTop = chat_container.scrollHeight

def hide_thinking():
    thinking = document["thinking-indicator"]
    if thinking:
        thinking.remove()

def handle_response(req):
    hide_thinking()
    if req.status == 200:
        try:
            data = json.loads(req.text)
            if data.get('candidates'):
                response_text = data['candidates'][0]['content']['parts'][0]['text']
                add_message(response_text)
                return
        except Exception as e:
            add_message(f"Parsing error: {str(e)}")
            return
    add_message(f"API Error: {req.status} {req.text}")

def handle_error(req):
    hide_thinking()
    add_message("Network Error: Failed to connect to API")

def handle_user_input(event=None):
    user_input = document["user-input"]
    message = user_input.value.strip()

    if not message:
        return

    if not API_KEY:
        add_message("ERROR: No API key provided")
        return

    user_input.value = ""
    add_message(message, is_user=True)
    show_thinking()

    payload = {
        "contents": [{
            "parts": [{"text": message}]
        }]
    }

    # Create AJAX request
    req = ajax.Ajax()
    req.open('POST', BASE_URL, True)
    req.set_header('Content-Type', 'application/json')
    req.bind('complete', lambda: handle_response(req))
    req.bind('error', lambda: handle_error(req))
    req.send(json.dumps(payload))

# Event listeners
document["send-btn"].bind("click", handle_user_input)
document["user-input"].bind("keypress", lambda event: handle_user_input() if event.key == "Enter" else None)
    </script>
</body>
</html>